REFERENCE 

code from original unix version of Thuria

